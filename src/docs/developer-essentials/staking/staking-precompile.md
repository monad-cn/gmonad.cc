# 质押预编译

注意

本页面针对希望构建与质押系统交互的智能合约或接口的开发者。

质押系统的入口点是有状态的质押预编译。

此预编译允许委托者和验证者执行影响验证者集合组成的操作。

- **加入**验证者集合（[`addValidator`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#addvalidator)）
- **委托**他们的质押给验证者（[`delegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegate)）
- **取消委托**他们从验证者的质押（多步过程：[`undelegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#undelegate)，等待 [`WITHDRAWAL_DELAY`](https://docs.monad.xyz/developer-essentials/staking/staking-behavior#constants) 个时期，然后 [`withdraw`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#withdraw)）
- **复投**他们作为委托者获得的奖励（即委托奖励）（[`compound`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#compound)）
- **领取**他们作为委托者获得的奖励（[`claimRewards`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#claimrewards)）

为了便于集成，请参见 [Solidity 接口](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#solidity-staking-interface) 和 [ABI JSON](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#staking-abi-json)。

尽管用户可以随时委托或取消委托，但质押权重变更只在时期边界生效，如 [质押行为](https://docs.monad.xyz/developer-essentials/staking/staking-behavior) 中所述，过于接近时期边界的质押权重变更会排队直到下一个时期边界。这是为了允许共识和执行的分离，这是 Monad 核心设计属性之一。

注意

只有标准的 `CALL` 被允许到质押预编译。特别是，不允许 `STATICCALL` 和 `DELEGATECALL`。

由于质押系统是预编译而不是智能合约，您无法在分叉环境中对其进行测试。

## 预编译地址和选择器

合约地址是 `0x0000000000000000000000000000000000001000`。

外部函数通过以下 4 字节选择器标识。

外部状态修改方法：

1. [`addValidator(bytes,bytes,bytes)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#addvalidator) - `0xf145204c`
2. [`delegate(uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegate) - `0x84994fec`
3. [`undelegate(uint64,uint256,uint8)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#undelegate) - `0x5cf41514`
4. [`withdraw(uint64,uint8)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#withdraw) - `0xaed2ee73`
5. [`compound(uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#compound) - `0xb34fea67`
6. [`claimRewards(uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#claimrewards) - `0xa76e2ca5`
7. [`changeCommission(uint64,uint256)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#changecommission) - `0x9bdcc3c8`
8. [`externalReward(uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#externalreward) - `0xe4b3303b`

外部视图方法：

1. [`getValidator(uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getvalidator) - `0x2b6d639a`
2. [`getDelegator(uint64,address)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getdelegator) - `0x573c1ce0`
3. [`getWithdrawalRequest(uint64,address,uint8)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getwithdrawalrequest) - `0x56fa2045`
4. [`getConsensusValidatorSet(uint32)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getvalidatorset) - `0xfb29b729`
5. [`getSnapshotValidatorSet(uint32)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getvalidatorset) - `0xde66a368`
6. [`getExecutionValidatorSet(uint32)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getvalidatorset) - `0x7cb074df`
7. [`getDelegations(address,uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getdelegations) - `0x4fd66050`
8. [`getDelegators(uint64,address)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getdelegators) - `0xa0843a26`
9. [`getEpoch()`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#getepoch) - `0x757991a8`

系统调用：

- [`syscallOnEpochChange(uint64)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#syscallonepochchange) - `0x1d4e9f02`
- [`syscallReward(address)`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#syscallreward) - `0x791bdcf3`
- [`syscallSnapshot()`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#syscallsnapshot) - `0x157eeb21`

## 外部状态修改方法

### `addValidator`

#### 函数选择器

```text
addValidator(bytes,bytes,bytes) : 0xf145204c
```



#### 函数签名

```solidity
function addValidator(
    bytes calldata payload,
    bytes calldata signedSecpMessage,
    bytes calldata signedBlsMessage
) external payable returns (uint64 validatorId);
```



#### 参数

1. ```
   payload
   ```

    

   \- 包含以下字段，按大端序打包在一起（等同于

    

   ```
   abi.encodePacked()
   ```

    

   在 Solidity 中）：

   - `bytes secpPubkey`（用于共识的唯一 SECP 公钥）
   - `bytes blsPubkey`（用于共识的唯一 BLS 公钥）
   - `address authAddress`（用于验证者委托账户的地址。此地址对验证者质押金额具有提取权限）
   - `uint256 amount`（验证者自质押的金额。必须等于 `msg.value`）
   - `uint256 commission`（向委托者收取的佣金乘以 1e18，例如 `10% = 1e17`）

2. `signedSecpMessage` - payload 的 SECP 签名

3. `signedBlsMessage` - payload 的 BLS 签名

#### Gas 成本

505,125

#### 行为

这会创建一个带有关联委托账户的验证者，并返回结果 `validatorId`。该方法首先解包有效负载以检索 `secpPubkey`、`blsPubkey`、`authAddress`、`amount` 和 `commission`，然后验证 `signedSecpMessage` 和 `signedBlsMessage` 是否对应于由相应 SECP 和 BLS 私钥签名的有效负载。

- 验证者必须提供唯一的 BLS 密钥和唯一的 SECP 密钥。任何重复公钥的提交都会回滚。

- 两个签名（`signedSecpMessage` 和 `signedBlsMessage`）都必须有效，并且必须对 `payload` 进行签名。

- 多个验证者可以共享相同的 `authAddress`。

- `msg.value` 必须等于或大于 `MIN_VALIDATE_STAKE`，否则调用会回滚。

- 如果

   

  ```
  msg.value
  ```

   

  也等于或大于

   

  ```
  ACTIVE_VALIDATOR_STAKE
  ```

   

  那么验证者将在未来变为活跃状态：

  - 如果 `addValidator` 在边界区块之前被调用，则在时期 `n+1`；
  - 否则它将在时期 `n+2` 变为活跃状态。

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 500ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">secp_pubkey</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> bls_pubkey</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> auth_address</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> payload</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">assert</span><span class="token plain" style="box-sizing: border-box;"> amount </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">==</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// increment validator id</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">last_val_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> last_val_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set uniqueness of keys</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">secp_to_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">secp_eth_address</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">bls_to_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">bls_eth_address</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set validator info</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> ValExecution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> commission</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">bytes</span><span class="token plain" style="box-sizing: border-box;"> secp_pubkey </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> secp_pubkey</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">bytes</span><span class="token plain" style="box-sizing: border-box;"> bls_pubkey </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> bls_pubkey</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> address_flags </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flags</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set authority delegator info</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">auth_address</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> DelInfo</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">2</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">3</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator accumulator</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">getEpoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> Accumulator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> ref_count </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set flags</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flags</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// push validator id</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;=</span><span class="token plain" style="box-sizing: border-box;"> ACTIVE_VALIDATOR_STAKE</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        and last_val_id not in execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">push</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">def </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flags</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;=</span><span class="token plain" style="box-sizing: border-box;"> ACTIVE_VALIDATOR_STAKE</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> ValidatorFlagsOk</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">last_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;=</span><span class="token plain" style="box-sizing: border-box;"> MIN_VALIDATE_STAKE</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> ValidatorFlagsStakeTooLow</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">def </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> in_epoch_delay_period</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">2</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">else</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> next_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> next_delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

#### 用法

以下是组装有效负载和签名的示例：

```text
def generate_add_validator_call_data_and_sign(
    secp_pubkey: bytes,
    bls_pubkey: bytes,   
    auth_address: bytes, 
    amount: int,  
    commission: int
    secp_privkey: bytes
    bls_privkey: bytes
) -> bytes:
    # 1) Encode
    payload_parts = [
        secp_pubkey,
        bls_pubkey,
        auth_address,
        toBigEndian32(amount),
        toBigEndian32(commission),
    ]
    payload = b"".join(payload_parts)


    # 2) Sign with both keys
    secp_sig = SECP256K1_SIGN(blake3(payload), secp_privkey) 
    bls_sig  = BLS_SIGN(hash_to_curve(payload), bls_privkey)


    # 3) Solidity encode the payload and two signatures
    return eth_abi.encode(['bytes', 'bytes', 'bytes'], [payload, secp_sig, bls_sig])
```



### `delegate`

#### 函数选择器

```text
delegate(uint64) : 0x84994fec
```



#### 函数签名

```solidity
function delegate(
    uint64 validatorId
) external payable returns (bool success);
```



#### 参数

1. `validatorId` - 委托者希望委托给的验证者 ID
2. `msg.value` - 要委托的金额

#### Gas 成本

260,850

#### 行为

如果委托账户不存在，这会创建一个委托账户并增加委托者的余额。

- 委托账户由 `msg.sender` 确定。
- `validatorId` 必须对应一个有效的验证者。
- `msg.value` 必须 > 0。
- 如果此委托导致验证者的总质押超过 `ACTIVE_VALIDATOR_STAKE`，那么如果验证者尚未存在，将被添加到 `execution_valset`。
- 委托质押变为活跃状态
  - 如果请求在边界区块之前，则在时期 `n+1`
  - 否则在时期 `n+2`

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 583ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">validator_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set validator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;">  ValExecution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">value</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">DelInfo current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// apply get_current_stake() first. This updates the delegator stake</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// to be inline with the current stake activated in consensus.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_current_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// apply add_stake() second.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">4</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">add_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">value</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> DelInfo</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">2</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">3</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set epoch accumulator</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">getEpoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">ref_count </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set flags</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flags</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// push validator id</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;=</span><span class="token plain" style="box-sizing: border-box;"> ACTIVE_VALIDATOR_STAKE</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        and validator_id not in execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">push</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">def </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">add_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> _delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> _next_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> _delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> _next_delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> not in_epoch_delay_period</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">else</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">next_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">2</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> _next_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> _delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> _next_delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">def </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">maybe_process_next_epoch_state</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token string" style="box-sizing: border-box; color: rgb(227, 17, 108);">""</span><span class="token plain" style="box-sizing: border-box;">"</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    Helper </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">function</span><span class="token plain" style="box-sizing: border-box;"> to process and update rewards</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    based on the current epoch state</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token string" style="box-sizing: border-box; color: rgb(227, 17, 108);">""</span><span class="token plain" style="box-sizing: border-box;">"</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">!=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        and current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        and current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        </span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// Compute rewards from the last checked epoch.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        _rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">*</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">            epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">val</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">            </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        </span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// Promote stake to active in delegator view.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">            epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">val</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">next_delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">next_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">next_delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">next_delta_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">delta_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">ref_count </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">def </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_current_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> _rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// Process next epoch rewards and increment stake</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">maybe_process_next_epoch_state</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// Perform again to capture max two additional epochs</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">maybe_process_next_epoch_state</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> _rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> _rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `undelegate`

#### 函数选择器

```text
undelegate(uint64,uint256,uint8) : 0x5cf41514
```



#### 函数签名

```solidity
function undelegate(
    uint64 validatorId,
    uint256 amount,
    uint8 withdrawId
) external returns (bool success);
```



#### 参数

1. `validatorId` - 发送者之前委托的验证者 ID，我们要从中移除委托
2. `amount` - 要取消委托的金额，以 Monad wei 为单位
3. `withdrawId` - 0 到 255 之间的整数（包含），用作委托者提取的标识符。对于每个（验证者，委托者）元组，最多可以有 256 个正在进行的提取请求

#### Gas 成本

147,750

#### 行为

This deducts `amount` from the delegator account and moves it to a withdrawal request object, where it remains in a pending state for [`WITHDRAWAL_DELAY`](https://docs.monad.xyz/developer-essentials/staking/staking-behavior#constants) epochs before the funds are claimable via the [`withdraw`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#withdraw) method.

- The delegator account is determined by `msg.sender`.
- `validatorId` must correspond to a valid validator to which the sender previously delegated
- The delegator must have stake >= amount.
- If the withdrawal causes `Val(validatorId).stake()` to drop below `ACTIVE_VALIDATOR_STAKE`, then the validator is scheduled to be removed from the valset.
- If the `authAddress` on a validator undelegates enough of their own stake to drop below `MIN_VALIDATE_STAKE`, then the validator is scheduled to be removed from the valset.
- The function will revert if there is a pending withdrawal with the same `withdrawId`. `withdrawId`s can be reused after calling [`withdraw`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#withdraw).
- A delegator can only remove a stake after it has been activated. This is the stake field in the delegator struct. Pending delegations cannot be removed until they are active.
- The delegator stake becomes inactive in the valset
  - in epoch `n+1` if the request is before the boundary block
  - in epoch `n+2` otherwise
- The delegator stake becomes withdrawable, and thus no longer subject to slashing
  - in epoch `n + 1 + WITHDRAWAL_DELAY` if the request is before the boundary block
  - in epoch `n + 2 + WITHDRAWAL_DELAY` otherwise

![timeline of undelegation and withdrawal](/images/docs/staking-precompile.png)Timeline of withdrawability of stake relative to `undelegate` command

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 427ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> validator_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> amount </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint8</span><span class="token plain" style="box-sizing: border-box;"> withdraw_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">withdraw_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">ValExecution current_validator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set validator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">current_validator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;">  ValExecution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-=</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// apply get_current_stake() first.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_current_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">DelInfo current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> DelInfo</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-=</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set withdraw request</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">withdrawal</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">withdraw_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> WithdrawalRequest</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> amount </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> acc </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_validator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">getEpoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set epoch accumulator</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">getEpoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">ref_count </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// schedule validator to leave set</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> current_validator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">stake</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&lt;</span><span class="token plain" style="box-sizing: border-box;"> ACTIVE_VALIDATOR_STAKE and validator_id in execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    current_validator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flag</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">INSUFFICIENT_STAKE</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">current_delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&lt;=</span><span class="token plain" style="box-sizing: border-box;"> MIN_VALIDATE_STAKE and validator_id in execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> and msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">==</span><span class="token plain" style="box-sizing: border-box;"> current_validator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">auth_address</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    current_validator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flag</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">INSUFFICIENT_VALIDATOR_STAKE</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `withdraw`

#### 函数选择器

```text
withdraw(uint64,uint8) : 0xaed2ee73
```



#### 函数签名

```solidity
function withdraw(
    uint64 validatorId,
    uint8 withdrawId
) external returns (bool success);
```



#### Parameters

1. `validatorId` - id of the validator to which sender previously delegated, from which we previously issued an `undelegate` command
2. `withdrawId` - identifier for a delegator's previously created withdrawal; the same id previously supplied to [`undelegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#undelegate). For each (validator, delegator) tuple, there can be a maximum of 256 in-flight withdrawal requests.

#### Gas cost

68,675

#### 行为

This completes an undelegation action (which started with a call to the `undelegate` function), sending the amount to `msg.sender`, provided that sufficient epochs have passed.

- The delegator is `msg.sender`. The withdrawal is identified by `msg.sender`, `validatorId`, and `withdrawId`
- The withdraw action can take place once the undelegation is complete, and the withdraw delay has passed:
  - in epoch `n + 1 + WITHDRAWAL_DELAY` if the undelegate request is before the boundary block
  - in epoch `n + 2 + WITHDRAWAL_DELAY` otherwise

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 353ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> validator_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint8</span><span class="token plain" style="box-sizing: border-box;"> withdraw_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">withdraw_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">WithdrawalRequest current_withdraw </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> withdrawal</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">withdraw_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// Compute any additional rewards and transfer funds to delegator</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">transfer</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> current_withdraw</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">amount </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_withdraw_rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// unset withdraw request</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">withdrawal</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">withdraw_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> WithdrawalRequest</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> amount </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> acc </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">def </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_withdraw_rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_withdraw</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">ref_count </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">return</span><span class="token plain" style="box-sizing: border-box;"> current_withdraw</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">amount</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">*</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_withdraw</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">val</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-</span><span class="token plain" style="box-sizing: border-box;"> current_withdraw</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `compound`

#### 函数选择器

```text
compound(uint64) : 0xb34fea67
```



#### 函数签名

```solidity
function compound(
    uint64 validatorId
) external returns (bool success);
```



#### Parameters

1. `validatorId` - id of the validator to which sender previously delegated, for which we are compounding rewards

#### Gas cost

285,050

#### 行为

This precompile converts the delegator's accumulated rewards into additional stake.

- The account compounded is determined by `msg.sender`. If a delegator account does not exist, then the call reverts
- `validatorId` must correspond to a valid validator to which the sender previously delegated
- The delegator rewards become active in the valset
  - in epoch `n+1` if the request is before the boundary block
  - in epoch `n+2` otherwise.

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 430ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">validator_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">DelInfo current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// apply get_current_stake() first. This updates the delegator stake</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// to be inline with the current stake activated in consensus.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">rewards_compounded </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_current_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// apply add_stake() second.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">4</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">add_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">rewards_compounded</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> DelInfo</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> next_delta_stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">2</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> next_delta_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> add_stake_info</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">3</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set validator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> ValExecution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> rewards_compounded</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set accumulator</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">getEpoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> Accumulator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> ref_count </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set flags</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">set_flags</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// push validator id</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;=</span><span class="token plain" style="box-sizing: border-box;"> ACTIVE_VALIDATOR_STAKE and validator_id not in execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">push</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `claimRewards`

#### 函数选择器

```text
claimRewards(uint64) : 0xa76e2ca5
```



#### 函数签名

```solidity
function claimRewards(
    uint64 validatorId
) external returns (bool success);
```



#### Parameters

1. `validatorId` - id of the validator to which sender previously delegated, for which we are claiming rewards

#### Gas cost

155,375

#### 行为

This precompile allows a delegator to claim any rewards instead of [compounding](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#compound) them.

- `validatorId` must correspond to a valid validator to which the sender previously delegated
- If delegator account does not exist for this `(validatorId, msg.sender)` tuple, then the call reverts
- The delegator's accumulated rewards are transferred to their delegation

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 328ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">DelInfo current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// apply get_current_stake() first.</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> current_rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">get_current_stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// set delegator information</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">current_delegator </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> DelInfo</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// send rewards to delegator</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">transfer</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">sender</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> current_rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `changeCommission`

#### 函数选择器

```text
changeCommission(uint64,uint256) : 0x9bdcc3c8
```



#### 函数签名

```solidity
function changeCommission(
    uint64 validatorId,
    uint256 commission
) external returns (bool success);
```



#### Parameters

1. `validatorId` - id of the validator, who would like to change their commission rate
2. `commission` - commission rate taken from block rewards, expressed in 1e18 units (e.g., 10% = 1e17)

#### Gas cost

39,475

#### 行为

这允许验证者的 `authAddress` 修改验证者的佣金。

佣金不能设置为大于 `MAX_COMMISSION`（目前为 100%）。

- The `msg.sender` must be the `authAddress` for the respective validator Id.
- The commission cannot be set larger than `MAX_COMMISSION` (currently 100%).
- The change in commission occurs in the following epochs:
  - in epoch `n+1` if request is not in the epoch delay period.
  - in epoch `n+2` if request is in the epoch delay period.

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 298ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">validator_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> ValExecution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">{</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">commission</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">}</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `externalReward`

#### 函数选择器

```text
externalReward(uint64) : 0xe4b3303b
```



#### 函数签名

```solidity
function externalReward(
    uint64 validatorId
) external returns (bool success);
```



#### Parameters

1. `validatorId` - id of the validator
2. `msg.value` - the MON to add to unclaimed rewards

#### Gas cost

62,300

#### 行为

This function allows anyone to send extra MON to the stakers of a particular validator. This typically will be called by the validator themselves to share extra tips to their delegators.

Notes:

- This can only be called for a validator currently in the consensus validator set; otherwise the transaction reverts.
- `msg.value` must be between 1 MON and 1,000,000 MON; otherwise the transaction reverts.
- Commission is not deducted from this and diverted to the validator's `auth_address`. If you wish for a portion to be deducted, it should be deducted before sending.

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 298ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">validator_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">require</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1e18</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&amp;&amp;</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&lt;=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1e24</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token string" style="box-sizing: border-box; color: rgb(227, 17, 108);">"Reward out of bounds"</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">require</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">val_consensus</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">&gt;</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token string" style="box-sizing: border-box; color: rgb(227, 17, 108);">"Validator not active"</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">validator_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">unclaimed_reward </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">acc </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">value </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">/</span><span class="token plain" style="box-sizing: border-box;"> val_consensus</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

## 外部视图方法

### `getValidator`

#### 函数选择器

```text
getValidator(uint64) : 0x2b6d639a
```



#### 函数签名

```solidity
function getValidator(
    uint64 validatorId
) external view returns (
    address authAddress,
    uint64 flags,
    uint256 stake,
    uint256 accRewardPerToken,
    uint256 commission,
    uint256 unclaimedRewards,
    uint256 consensusStake,
    uint256 consensusCommission,
    uint256 snapshotStake,
    uint256 snapshotCommission,
    bytes memory secpPubkey,
    bytes memory blsPubkey
);
```



#### Parameters

1. `validatorId` - id of the validator

#### Gas cost

97,200

#### 行为

This is the primary method to obtain information about a validator state. It provides a complete view of the validator’s state across execution, consensus, and snapshot contexts.

It returns:

- [`ValExecution`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#validator-structs) (execution view)
- Stake and commission (consensus view)
- Stake and commission (snapshot view)

### `getDelegator`

#### 函数选择器

```text
getDelegator(uint64,address) : 0x573c1ce0
```



#### 函数签名

```solidity
function getDelegator(
    uint64 validatorId, 
    address delegator
) external returns (
    uint256 stake,
    uint256 accRewardPerToken,
    uint256 unclaimedRewards,
    uint256 deltaStake,
    uint256 nextDeltaStake,
    uint64 deltaEpoch,
    uint64 nextDeltaEpoch
);
```



#### Parameters

1. `validatorId` - id of the validator
2. `delegator` - address of the delegator about whose stake we are inquiring

#### Gas cost

184,900

#### 行为

This returns the delegator’s [`DelInfo`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegator-structs) for the specified validator, providing a view of the delegator’s stake, accumulated rewards and pending changes in stake.

### `getWithdrawalRequest`

#### 函数选择器

```text
getWithdrawalRequest(uint64,address,uint8) : 0x56fa2045
```



#### 函数签名

```solidity
function getWithdrawalRequest(
    uint64 validatorId,
    address delegator,
    uint8 withdrawId
) external returns (
    uint256 withdrawalAmount,
    uint256 accRewardPerToken,
    uint64 withdrawEpoch
);
```



#### Gas cost

24,300

#### 行为

This returns the pending [`WithdrawalRequest`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegator-structs) for the `(validatorId, delegator, withdrawId)` tuple.

### `get*ValidatorSet`

#### 函数选择器s

```text
getConsensusValidatorSet(uint32) : 0xfb29b729
getSnapshotValidatorSet(uint32) : 0xde66a368
getExecutionValidatorSet(uint32) : 0x7cb074df
```



#### 函数签名s

```solidity
function getConsensusValidatorSet(
    uint32 startIndex
) external returns (bool isDone, uint32 nextIndex, uint64[] memory valIds);


function getSnapshotValidatorSet(
    uint32 startIndex
) external returns (bool isDone, uint32 nextIndex, uint64[] memory valIds);


function getExecutionValidatorSet(
    uint32 startIndex
) external returns (bool isDone, uint32 nextIndex, uint64[] memory valIds);
```



#### Parameters

1. `startIndex` - since the list being looked up is potentially very long, each of these functions is paginated, returning a fixed-length subset of the desired list. Pass `startIndex` to indicate where in the list to start.

#### Gas cost

814,000 gas (assuming `PAGINATED_RESULTS_SIZE = 100`).

#### 行为

These functions return the consensus, snapshot, and execution validator ids, respectively.

Each call retrieves up to `PAGINATED_RESULTS_SIZE` validator ids starting from `startIndex` and returns a tuple `(bool done, uint32 nextIndex, uint256[] valids)`.

The `bool isDone` indicates whether the end of the list was reached. The `uint32 nextIndex` is the last slot in the array.

### `getDelegations`

#### 函数选择器

```text
getDelegations(address,uint64) : 0x4fd66050
```



#### 函数签名

```solidity
function getDelegations(
    address delegator,
    uint64 startValId
) external returns (bool isDone, uint64 nextValId, uint64[] memory valIds);
```



#### Parameters

1. `delegator` - the address whose delegations we want to look up
2. `startValId`

#### Gas cost

814,000

#### 行为

Each call retrieves up to `PAGINATED_RESULTS_SIZE` validator ids starting from `startValId` and returns a tuple `(bool isDone, uint64 nextValId, uint64[] valIds)` with delegation from the input `delegator` address.

The `bool isdone` indicates whether the end of the list was reached. The `uint64 nextValId` is the id after the last element in `valIds`. Use it as the `startValId` for the next call.

If `delegator` has delegated to over `PAGINATED_RESULTS_SIZE` validator ids, multiple calls are required (while `isDone` is false).

To capture the full set, the make the first function call using `startValId = 0`.

### `getDelegators`

#### 函数选择器

```text
getDelegators(uint64,address) : 0xa0843a26
```



#### 函数签名

```solidity
function getDelegators(
    uint64 validatorId,
    address startDelegator
) external returns (bool isDone, address nextDelegator, address[] memory delegators);
```



#### Parameters

1. `validatorId` - the id of the validator for which we want to know the delegators
2. `startDelegator`

#### Gas cost

814,000

#### 行为

Each call retrieves up to `PAGINATED_RESULTS_SIZE` delegator addresses starting from `startDelegator` and returns a tuple `(bool isDone, address nextDelegator, address[] delegators)` with delegation to the input `validatorId`.

The `bool isDone` indicates the end of the list was reached. The `nextDelegator` is the address immediately after the last element in `delegators`. Use it as `startDelegator` for the next call.

To capture the full set, the function should be called with `startDelegator = 0`.

note

The number of delegators to a given validator can be very large, so it is recommended to maintain an updated list via the [events](https://docs.monad.xyz/monad-arch/realtime-data/data-sources#real-time-data-sources) framework, rather than periodically calling this expensive lookup.

### `getEpoch`

#### 函数选择器

```text
getEpoch() : 0x757991a8
```



#### 函数签名

```solidity
function getEpoch() external returns (uint64 epoch, bool inEpochDelayPeriod);
```



#### Gas cost

16,200

#### 行为

This function is a handy utility to determine the current epoch and timing within the epoch (before or after the boundary block).

If `inEpochDelayPeriod` is false, the boundary block has not been reached yet and write operations at that time should be effective for `epoch + 1`. If `inEpochDelayPeriod` is true, the network is past the boundary block and and write operations at that time should be effective for `epoch + 2`

## 系统调用

There are currently three syscalls. Users cannot invoke these directly. They are only triggered through special system transactions.

### `syscallOnEpochChange`

#### 函数选择器

```text
syscallOnEpochChange(uint64) : 0x1d4e9f02
```



#### 函数签名

```solidity
function syscallOnEpochChange(uint64 epoch) external;
```



#### Parameters

1. `epoch` - the new consensus epoch being entered

#### 行为

This syscall is triggered at the end of the epoch delay period. It performs the following actions:

1. If the validator received a request to change stake in the previous epoch and participated in the previous epoch’s consensus validator set then it saves the corresponding accumulator value
2. If any validator was active in the previous epoch but becomes inactive in the current epoch, it also saves their current accumulator value
3. Sets the current epoch in state

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 310ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> msg</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">input</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">for</span><span class="token plain" style="box-sizing: border-box;"> i in snapshot_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">is</span><span class="token plain" style="box-sizing: border-box;"> not empty</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">val</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">if</span><span class="token plain" style="box-sizing: border-box;"> epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">is</span><span class="token plain" style="box-sizing: border-box;"> not empty</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">        epoch_acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">current_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">val</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">acc</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">in_epoch_delay_period </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token boolean" style="box-sizing: border-box; color: rgb(54, 172, 170);">false</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">epoch </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> current_epoch</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `syscallReward`

#### 函数选择器

```text
syscallReward(address) : 0x791bdcf3
```



#### 函数签名

```solidity
function syscallReward(address blockAuthor) external;
```



#### Parameters

1. `blockAuthor` — the address of the validator that produced the block.

#### 行为

This syscall is invoked for every block. It rewards the block-producing validator (and their delegators) with the configured block reward:

1. If the validator has a nonzero commission, a portion of the reward is allocated to the validator’s `authAddress`.
2. The remaining reward is claimable to the validator’s delegators.

Note that the commission is calculated as a percentage of the total block reward.

Example

- Suppose that a validator's personal stake comprises 20% of the total delegation to their validator.
- The commission is set at 10% of total rewards.

Then the validator receives 10% of the total block reward as their commission. The remaining 90% of the reward is distributed to the stake pool. Since the validator owns 20% of the pool, they also receive 20% of that remaining amount.

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 317ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token plain" style="box-sizing: border-box;"> val_id </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> secp_to_val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">block_author</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">DelInfo auth_del </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> delegator</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">auth_address</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> _commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> REWARD </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">*</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">/</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">1e18</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint256</span><span class="token plain" style="box-sizing: border-box;"> _unclaimed_rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> REWARD </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">-</span><span class="token plain" style="box-sizing: border-box;"> _commission</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token comment" style="box-sizing: border-box; color: rgb(153, 153, 136); font-style: italic;">// state update</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">auth_del</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> _commission</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">unclaimed_rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> _unclaimed_rewards</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">acc </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">+=</span><span class="token plain" style="box-sizing: border-box;"> _unclaimed_rewards </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">/</span><span class="token plain" style="box-sizing: border-box;"> val_consensus</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">val_id</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">mint</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">STAKING_CONTRACT_ADDRESS</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">,</span><span class="token plain" style="box-sizing: border-box;"> REWARD</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

### `syscallSnapshot`

#### 函数选择器

```text
syscallSnapshot() : 0x157eeb21
```



#### 函数签名

```solidity
function syscallSnapshot() external;
```



#### Parameters

(none)

#### 行为

This syscall sorts the current execution-layer validator set. It selects the top `N` staked validators as the upcoming consensus validator set. The updated set is stored in state. The previous consensus set is cleared.

<details class="details_lb9f isBrowser_bmU9 alert alert--info details_b_Ee" data-collapsed="false" open="" style="box-sizing: border-box; color: rgb(0, 0, 0); --ifm-alert-background-color: #fbfaf9; --ifm-alert-background-color-highlight: #54c7ec26; --ifm-alert-foreground-color: #000; --ifm-alert-border-color: #6247f5; --ifm-code-background: #54c7ec26; --ifm-link-color: #000; --ifm-link-hover-color: #000; --ifm-link-decoration: underline; --ifm-tabs-color: #000; --ifm-tabs-color-active: #000; --ifm-tabs-color-active-border: #6247f5; background-color: rgb(251, 250, 249); border-color: rgb(98, 71, 245); border-style: solid; border-width: 1px; border-image: none 100% / 1 / 0 stretch; border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; padding: 16px; transition: border-color 0.3s; --docusaurus-details-summary-arrow-size: 0.38rem; --docusaurus-details-transition: transform 200ms ease; --docusaurus-details-decoration-color: #6247f5; margin: 0px 0px 16px; font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, &quot;system-ui&quot;, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;">Pseudocode</summary><div style="box-sizing: border-box; display: block; overflow: visible; height: auto; will-change: height; transition: height 328ms ease-in-out;"><div class="collapsibleContent_i85q" style="box-sizing: border-box; border-top: 1px solid rgb(98, 71, 245); margin-top: 1rem; padding-top: 1rem;"><div class="language-solidity codeBlockContainer_APcc theme-code-block" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); color: rgb(57, 58, 52); border-radius: 6.4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 2px 0px; margin-bottom: 20px; --prism-color: #393A34; --prism-background-color: #f6f8fa;"><div class="codeBlockContent_m3Ux" style="box-sizing: border-box; border-radius: inherit; direction: ltr; position: relative;"><pre tabindex="0" class="prism-code language-solidity codeBlock_qGQc thin-scrollbar" style="box-sizing: border-box; margin: 0px; background-color: rgb(246, 248, 250); border-radius: 6.4px; color: rgb(57, 58, 52); font: 400 15.2px / 1.45 SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; padding: 0px; overflow: unset; --ifm-pre-background: #f6f8fa; display: flex; position: relative; scrollbar-width: thin;"><code class="codeBlockLinesContainer_wQwV" style="box-sizing: border-box; vertical-align: middle; background-color: initial; border: none; border-top-left-radius: 0px !important; border-top-right-radius: 0px !important; border-bottom-right-radius: 6.4px; border-bottom-left-radius: 6.4px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; font-size: 15.2px; padding: 0px; overflow-x: scroll; position: relative; scrollbar-width: none; line-height: inherit; display: block; width: 924px;"><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-top: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token builtin" style="box-sizing: border-box;">uint64</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token plain" style="box-sizing: border-box;"> filter_top_n_validators </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token function" style="box-sizing: border-box; color: rgb(215, 58, 73);">sort</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">(</span><span class="token plain" style="box-sizing: border-box;">execution_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">)</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">for</span><span class="token plain" style="box-sizing: border-box;"> i in snapshot_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    val_snapshot</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    val_snapshot</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> </span><span class="token number" style="box-sizing: border-box; color: rgb(54, 172, 170);">0</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">snapshot_valset </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> consensus_valset</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">consensus_valset </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> filter_top_n_validators</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box; display: inline-block;">
</span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;"></span><span class="token keyword" style="box-sizing: border-box; color: rgb(0, 0, 159);">for</span><span class="token plain" style="box-sizing: border-box;"> i in filter_top_n_validators</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">:</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    val_consensus</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">stake </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">stake</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span><span class="token plain" style="box-sizing: border-box;"></span></div><div class="codeBlockLine_D75C" style="box-sizing: border-box; min-width: fit-content; padding-left: 0.7em; font-size: 1em; line-height: 1.5; padding-bottom: 0.5em; color: rgb(57, 58, 52);"><span class="token plain" style="box-sizing: border-box;">    val_consensus</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">commission </span><span class="token operator" style="box-sizing: border-box; color: rgb(57, 58, 52);">=</span><span class="token plain" style="box-sizing: border-box;"> val_execution</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">[</span><span class="token plain" style="box-sizing: border-box;">i</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">]</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">.</span><span class="token plain" style="box-sizing: border-box;">commission</span><span class="token punctuation" style="box-sizing: border-box; color: rgb(57, 58, 52);">;</span></div></code></pre><div class="buttonGroup_6DOT" style="box-sizing: border-box; column-gap: 0.2rem; display: flex; position: absolute; right: 8px; top: 8px;"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn" style="box-sizing: border-box; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(246, 248, 250); border-width: 1px; border-style: solid; border-color: rgb(218, 221, 225); border-image: none 100% / 1 / 0 stretch; color: rgb(57, 58, 52); cursor: pointer; font-family: inherit; padding: 0.4rem; align-items: center; border-radius: 6.4px; display: flex; line-height: 0; opacity: 0; transition: opacity 0.2s ease-in-out;"><span class="copyButtonIcons_FhaS" aria-hidden="true" style="box-sizing: border-box; height: 1.125rem; position: relative; width: 1.125rem;"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>

## 事件

The staking precompiles emit standard events that appear in transaction receipts. These events provide indexed information about validator and delegator actions.

### `ValidatorRewarded`

```solidity
event ValidatorRewarded(
        uint64 indexed validatorId,
        address indexed from,
        uint256 amount,
        uint64 epoch
);
```



Emitted when block reward is allocated via [`syscallReward`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#syscallReward).

### `ValidatorCreated`

```solidity
event ValidatorCreated(
    uint64  indexed validatorId,
    address indexed authAddress,
    uint256 commission
);
```



Emitted when a validator is added via [`addValidator`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#addvalidator).

### `ValidatorStatusChanged`

```solidity
event ValidatorStatusChanged(
    uint64  indexed validatorId,
    uint64  flags
);
```



Emitted during [`addValidator`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#addvalidator), [`delegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegate), [`undelegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#undelegate), or [`compound`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#compound). if the validator's flags change.

### `Delegate`

```solidity
event Delegate(
    uint64  indexed validatorId,
    address indexed delegator,
    uint256 amount,
    uint64  activationEpoch
);
```



Emitted when delegation amount is increased, i.e. during [`addValidator`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#addvalidator), [`delegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegate), or [`compound`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#compound).

### `Undelegate`

```solidity
event Undelegate(
    uint64  indexed validatorId,
    address indexed delegator,
    uint8   withdrawId,
    uint256 amount,
    uint64  activationEpoch
);
```



Emitted when a delegator calls [`undelegate`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#undelegate).

### `Withdraw`

```solidity
event Withdraw(
    uint64 indexed validatorId,
    address indexed delegator,
    uint8   withdrawId,
    uint256 amount,
    uint64  withdrawEpoch
);
```



Emitted when a delegator executes [`withdraw`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#withdraw) successfully.

### `ClaimRewards`

```solidity
event ClaimRewards(
    uint64 indexed validatorId,
    address indexed delegator,
    uint256 amount,
    uint64 epoch
);
```



Emitted when a delegator claims rewards via [`claimRewards`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#claimrewards).

### `CommissionChanged`

```solidity
event CommissionChanged(
    uint64 indexed validatorId,
    uint256 oldCommission,
    uint256 newCommission
);
```



Emitted when a validator changes commission via [`changeCommission`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#changecommission).

### `EpochChanged`

```solidity
    event EpochChanged(
        uint64 oldEpoch,
        uint64 newEpoch
    );
```



Emitted when epoch changes via [`syscallOnEpochChange`](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#syscallOnEpochChange).

## 预编译内部实现

- [Constants](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#constants-1)
- [Validator structs](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#validator-structs)
- [Delegator structs](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#delegator-structs)
- [State variables](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#state-variables)
- [Mappings](https://docs.monad.xyz/developer-essentials/staking/staking-precompile#mappings)

### Constants

```solidity
// Minimum stake required from validator's own account
// to be eligible to join the valset, in Monad wei
uint256 MIN_VALIDATE_STAKE;


// Min stake required (including delegation) for validator
// to be eligible to join the valset, in Monad wei.
// note that ACTIVE_VALIDATOR_STAKE > MIN_VALIDATE_STAKE
uint256 ACTIVE_VALIDATOR_STAKE;


// Block Reward
uint256 REWARD;


// Accumulator unit multiplier. Chosen to preserve accuracy
uint256 ACCUMULATOR_DENOMINATOR = 1e36;


// Staking precompile address
Address STAKING_CONTRACT_ADDRESS = 0x0000000000000000000000000000000000001000;


// Withdrawal delay, needed to facilitate slashing
uint8 WITHDRAWAL_DELAY = 1;


// Controls the maximum number of results returned by individual
// calls to valset-getters, get_delegators, and get_delegations
uint64 PAGINATED_RESULTS_SIZE = 100;
```



### Validator structs

```solidity
struct ValExecution             // Realtime execution state for one validator
{
    uint256 stake;              // Upcoming stake pool balance
    uint256 acc;                // Current accumulator value for validator
    uint256 commission;         // Proportion of block reward charged as commission, times 1e18; 10% = 1e17
    bytes   secp_pubkey;        // Secp256k1 public key used by consensus
    bytes   bls_pubkey;         // Bls public key used by consensus
    uint256 address_flags;      // Flags to represent validators' current state
    uint256 unclaimed_rewards;  // Unclaimed rewards
    address auth_address;       // Delegator address with authority over validator stake
}


struct ValConsensus             // A subset of validator state for the consensus system
{
    uint256 stake;              // Current active stake
    uint256 commission;         // Commission rate for current epoch
    bytes   secp_pubkey;        // Secp256k1 public key used by consensus
    bytes   bls_pubkey;         // Bls public key used by consensus
}
```



### Delegator structs

```solidity
struct DelInfo
{
    uint256 stake;               // Current active stake
    uint256 acc;                 // Last checked accumulator
    uint256 rewards;             // Last checked rewards
    uint256 delta_stake;         // Stake to be activated next epoch
    uint256 next_delta_stake;    // Stake to be activated in 2 epochs
    uint64 delta_epoch;          // Epoch when delta_stake becomes active
    uint64 next_delta_epoch;     // Epoch when next_delta_stake becomes active
}


struct WithdrawalRequest
{
    uint256 amount;              // Amount to undelegate from validator
    uint256 acc;                 // Validator accumulator when undelegate was called
    uint64 epoch;                // Epoch when undelegate stake deactivates
};


struct Accumulator
{
    uint256 val;               // Current accumulator value
    uint256 refcount;            // Reference count for this accumulator value
};
```



### State variables

```solidity
// Current consensus epoch
uint64 epoch;


// Flag indicating if currently in epoch delay period
bool in_epoch_delay_period;


// Counter for validator ids
uint64 last_val_id;


// Current execution view of validator set
StorageArray<uint64> execution_valset;


// Previous consensus view of validator set
StorageArray<uint64> snapshot_valset;


// Current consensus view of validator set
StorageArray<uint64> consensus_valset;
```



### Mappings

```solidity
//These mappings only exist to ensure the SECP/BLS Keys are unique
mapping (secp_eth_address => uint64) secp_to_val_id;
mapping (bls_eth_address => uint64) bls_to_val_id;


// Keys(val_id, epoch) => Value(acc)
// making note of the validator accumulator at start of epoch.
mapping(uint64 => mapping(uint64 => Accumulator)) epoch_acc;


// Key(val_id)
// Contains the validator info for the execution view. Changes to stake
// or commission are reflected immediately.
mapping(uint64 => ValExecution) val_execution;


// Key(val_id)
// Contains a subset of the validator info relevant to consensus. Changes to
// stake or commission are reflected in the following epoch. This is referenced
// by the reward system call *before* the epoch delay period.
mapping(uint64 => ValConsensus) val_consensus;


// Key(val_id)
// Contains a subset of the validator info relevant to consensus. Changes to
// stake or commission are reflected in the following epoch. This is referenced
// by the reward system call *during* the epoch delay period.
mapping(uint64 => ValConsensus) val_snapshot;


// Keys(val_id,msg.sender) => DelInfo
mapping(uint64 => mapping(address => DelInfo)) delegator;


// Keys(val_id,msg.sender,withdrawal_id) => WithdrawalRequest
mapping(uint64 => mapping(address => mapping (uint8 => WithdrawalRequest))) withdrawal;
```



## Solidity 质押接口

*要复制到剪贴板，请点击代码块右上角的按钮。*

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.15;


interface IMonadStaking {
    function addValidator(
        bytes calldata payload,
        bytes calldata signedSecpMessage,
        bytes calldata signedBlsMessage
    ) external payable returns (uint64 validatorId);


    function delegate(
        uint64 validatorId
    ) external payable returns (bool success);


    function undelegate(
        uint64 validatorId,
        uint256 amount,
        uint8 withdrawId
    ) external returns (bool success);


    function compound(
        uint64 validatorId
    ) external returns (bool success);


    function withdraw(
        uint64 validatorId,
        uint8 withdrawId
    ) external returns (bool success);


    function claimRewards(
        uint64 validatorId
    ) external returns (bool success);


    function changeCommission(
        uint64 validatorId,
        uint256 commission
    ) external returns (bool success);


    function externalReward(
        uint64 validatorId
    ) external returns (bool success);




    function getValidator(
        uint64 validatorId
    ) external view returns (
        address authAddress,
        uint64 flags,
        uint256 stake,
        uint256 accRewardPerToken,
        uint256 commission,
        uint256 unclaimedRewards,
        uint256 consensusStake,
        uint256 consensusCommission,
        uint256 snapshotStake,
        uint256 snapshotCommission,
        bytes memory secpPubkey,
        bytes memory blsPubkey
    );


    function getDelegator(
        uint64 validatorId, 
        address delegator
    ) external returns (
        uint256 stake,
        uint256 accRewardPerToken,
        uint256 unclaimedRewards,
        uint256 deltaStake,
        uint256 nextDeltaStake,
        uint64 deltaEpoch,
        uint64 nextDeltaEpoch
    );


    function getWithdrawalRequest(
        uint64 validatorId,
        address delegator,
        uint8 withdrawId
    ) external returns (
        uint256 withdrawalAmount,
        uint256 accRewardPerToken,
        uint64 withdrawEpoch
    );


    function getConsensusValidatorSet(
        uint32 startIndex
    ) external returns (bool isDone, uint32 nextIndex, uint64[] memory valIds);


    function getSnapshotValidatorSet(
        uint32 startIndex
    ) external returns (bool isDone, uint32 nextIndex, uint64[] memory valIds);


    function getExecutionValidatorSet(
        uint32 startIndex
    ) external returns (bool isDone, uint32 nextIndex, uint64[] memory valIds);


    function getDelegations(
        address delegator,
        uint64 startValId
    ) external returns (bool isDone, uint64 nextValId, uint64[] memory valIds);


    function getDelegators(
        uint64 validatorId,
        address startDelegator
    ) external returns (bool isDone, address nextDelegator, address[] memory delegators);




    function getEpoch() external returns (uint64 epoch, bool inEpochDelayPeriod);


    function syscallOnEpochChange(uint64 epoch) external;


    function syscallReward(address blockAuthor) external;


    function syscallSnapshot() external;


     event ValidatorRewarded(
        uint64 indexed validatorId,
        address indexed from,
        uint256 amount,
        uint64 epoch
    );
    event ValidatorCreated(
        uint64  indexed validatorId,
        address indexed authAddress,
        uint256 commission


    );
    event ValidatorStatusChanged(
        uint64  indexed validatorId,
        uint64  flags
    );
    event Delegate(
        uint64  indexed validatorId,
        address indexed delegator,
        uint256 amount,
        uint64  activationEpoch
    );
    event Undelegate(
        uint64  indexed validatorId,
        address indexed delegator,
        uint8   withdrawId,
        uint256 amount,
        uint64  activationEpoch
    );
    event Withdraw(
        uint64 indexed validatorId,
        address indexed delegator,
        uint8   withdrawId,
        uint256 amount,
        uint64  withdrawEpoch
    );
    event ClaimRewards(
        uint64 indexed validatorId,
        address indexed delegator,
        uint256 amount,
        uint64  epoch
    );
    event CommissionChanged(
        uint64 indexed validatorId,
        uint256 oldCommission,
        uint256 newCommission
    );
    event EpochChanged(
        uint64 oldEpoch,
        uint64 newEpoch
    );
}
```



## 质押 ABI JSON

*要复制到剪贴板，请点击代码块右上角的按钮。*

```json
[
  {"type":"function","name":"addValidator","inputs":[{"name":"payload","type":"bytes","internalType":"bytes"},{"name":"signedSecpMessage","type":"bytes","internalType":"bytes"},{"name":"signedBlsMessage","type":"bytes","internalType":"bytes"}],"outputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"}],"stateMutability":"payable"},
  {"type":"function","name":"changeCommission","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"},{"name":"commission","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"claimRewards","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"compound","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"delegate","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"payable"},
  {"type":"function","name":"externalReward","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getConsensusValidatorSet","inputs":[{"name":"startIndex","type":"uint32","internalType":"uint32"}],"outputs":[{"name":"isDone","type":"bool","internalType":"bool"},{"name":"nextIndex","type":"uint32","internalType":"uint32"},{"name":"valIds","type":"uint64[]","internalType":"uint64[]"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getDelegations","inputs":[{"name":"delegator","type":"address","internalType":"address"},{"name":"startValId","type":"uint64","internalType":"uint64"}],"outputs":[{"name":"isDone","type":"bool","internalType":"bool"},{"name":"nextValId","type":"uint64","internalType":"uint64"},{"name":"valIds","type":"uint64[]","internalType":"uint64[]"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getDelegator","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"},{"name":"delegator","type":"address","internalType":"address"}],"outputs":[{"name":"stake","type":"uint256","internalType":"uint256"},{"name":"accRewardPerToken","type":"uint256","internalType":"uint256"},{"name":"unclaimedRewards","type":"uint256","internalType":"uint256"},{"name":"deltaStake","type":"uint256","internalType":"uint256"},{"name":"nextDeltaStake","type":"uint256","internalType":"uint256"},{"name":"deltaEpoch","type":"uint64","internalType":"uint64"},{"name":"nextDeltaEpoch","type":"uint64","internalType":"uint64"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getDelegators","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"},{"name":"startDelegator","type":"address","internalType":"address"}],"outputs":[{"name":"isDone","type":"bool","internalType":"bool"},{"name":"nextDelegator","type":"address","internalType":"address"},{"name":"delegators","type":"address[]","internalType":"address[]"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getEpoch","inputs":[],"outputs":[{"name":"epoch","type":"uint64","internalType":"uint64"},{"name":"inEpochDelayPeriod","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getExecutionValidatorSet","inputs":[{"name":"startIndex","type":"uint32","internalType":"uint32"}],"outputs":[{"name":"isDone","type":"bool","internalType":"bool"},{"name":"nextIndex","type":"uint32","internalType":"uint32"},{"name":"valIds","type":"uint64[]","internalType":"uint64[]"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getSnapshotValidatorSet","inputs":[{"name":"startIndex","type":"uint32","internalType":"uint32"}],"outputs":[{"name":"isDone","type":"bool","internalType":"bool"},{"name":"nextIndex","type":"uint32","internalType":"uint32"},{"name":"valIds","type":"uint64[]","internalType":"uint64[]"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"getValidator","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"}],"outputs":[{"name":"authAddress","type":"address","internalType":"address"},{"name":"flags","type":"uint64","internalType":"uint64"},{"name":"stake","type":"uint256","internalType":"uint256"},{"name":"accRewardPerToken","type":"uint256","internalType":"uint256"},{"name":"commission","type":"uint256","internalType":"uint256"},{"name":"unclaimedRewards","type":"uint256","internalType":"uint256"},{"name":"consensusStake","type":"uint256","internalType":"uint256"},{"name":"consensusCommission","type":"uint256","internalType":"uint256"},{"name":"snapshotStake","type":"uint256","internalType":"uint256"},{"name":"snapshotCommission","type":"uint256","internalType":"uint256"},{"name":"secpPubkey","type":"bytes","internalType":"bytes"},{"name":"blsPubkey","type":"bytes","internalType":"bytes"}],"stateMutability":"view"},
  {"type":"function","name":"getWithdrawalRequest","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"},{"name":"delegator","type":"address","internalType":"address"},{"name":"withdrawId","type":"uint8","internalType":"uint8"}],"outputs":[{"name":"withdrawalAmount","type":"uint256","internalType":"uint256"},{"name":"accRewardPerToken","type":"uint256","internalType":"uint256"},{"name":"withdrawEpoch","type":"uint64","internalType":"uint64"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"syscallOnEpochChange","inputs":[{"name":"epoch","type":"uint64","internalType":"uint64"}],"outputs":[],"stateMutability":"nonpayable"},
  {"type":"function","name":"syscallReward","inputs":[{"name":"blockAuthor","type":"address","internalType":"address"}],"outputs":[],"stateMutability":"nonpayable"},
  {"type":"function","name":"syscallSnapshot","inputs":[],"outputs":[],"stateMutability":"nonpayable"},
  {"type":"function","name":"undelegate","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"},{"name":"amount","type":"uint256","internalType":"uint256"},{"name":"withdrawId","type":"uint8","internalType":"uint8"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"function","name":"withdraw","inputs":[{"name":"validatorId","type":"uint64","internalType":"uint64"},{"name":"withdrawId","type":"uint8","internalType":"uint8"}],"outputs":[{"name":"success","type":"bool","internalType":"bool"}],"stateMutability":"nonpayable"},
  {"type":"event","name":"ClaimRewards","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"delegator","type":"address","indexed":true,"internalType":"address"},{"name":"amount","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"epoch","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false},
  {"type":"event","name":"CommissionChanged","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"oldCommission","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"newCommission","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},
  {"type":"event","name":"Delegate","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"delegator","type":"address","indexed":true,"internalType":"address"},{"name":"amount","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"activationEpoch","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false},
  {"type":"event","name":"EpochChanged","inputs":[{"name":"oldEpoch","type":"uint64","indexed":false,"internalType":"uint64"},{"name":"newEpoch","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false},
  {"type":"event","name":"Undelegate","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"delegator","type":"address","indexed":true,"internalType":"address"},{"name":"withdrawId","type":"uint8","indexed":false,"internalType":"uint8"},{"name":"amount","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"activationEpoch","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false},
  {"type":"event","name":"ValidatorCreated","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"authAddress","type":"address","indexed":true,"internalType":"address"},{"name":"commission","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},
  {"type":"event","name":"ValidatorRewarded","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"from","type":"address","indexed":true,"internalType":"address"},{"name":"amount","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"epoch","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false},
  {"type":"event","name":"ValidatorStatusChanged","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"flags","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false},
  {"type":"event","name":"Withdraw","inputs":[{"name":"validatorId","type":"uint64","indexed":true,"internalType":"uint64"},{"name":"delegator","type":"address","indexed":true,"internalType":"address"},{"name":"withdrawId","type":"uint8","indexed":false,"internalType":"uint8"},{"name":"amount","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"withdrawEpoch","type":"uint64","indexed":false,"internalType":"uint64"}],"anonymous":false}
]
```